<project name="scala-stm" basedir="." default="build">

  <property name="name"    value="${ant.project.name}"/>
  <property name="version" value="@VERSION@"/>
  <property name="author"  value="org.scala-stm"/>

  <path id="scala.classpath">
    <fileset dir="/usr/share/java" includes="scala/scala-compiler.jar"/>
    <fileset dir="/usr/share/java" includes="scala/scala-library.jar"/>
  </path>
  
  <path id="scala-stm.classpath">
    <path refid="scala.classpath"/>
    <pathelement location="target/classes"/>
  </path>

  <target name="prepare">
    <mkdir dir="target/doc/main/api"/>
    <mkdir dir="target/classes"/>
  </target>

  <target name="clean">
    <delete dir="target"/>
  </target>

  <taskdef resource="scala/tools/ant/antlib.xml" classpathref="scala.classpath"/>

  <target name="build" depends="prepare">
    <scalac
      addParams="-deprecation"
      srcdir="src/main/scala"
      destdir="target/classes"
      classpathref="scala-stm.classpath"/>
  </target>

  <target name="doc" depends="prepare">
    <copy todir="target/doc/main">
      <fileset dir=".">
        <include name="LICENSE.txt"/>
        <include name="RELEASE-NOTES.txt"/>
      </fileset>
    </copy>
    <scaladoc
      srcdir="src/main/scala"
      destdir="target/doc/main/api"
      doctitle="${name} ${version}"
      classpathref="scala-stm.classpath">
      <include name="**/*.scala"/>
    </scaladoc>
  </target>

  <target name="jar" depends="clean,build">
    <jar destfile="target/${name}.jar">
      <fileset dir="target/classes">
        <include name="scala/**"/>
      </fileset>
      <manifest>
        <attribute name="Built-By"                 value="${user.name}"/>
        <attribute name="Specification-Title"      value="${name}"/>
        <attribute name="Specification-Version"    value="${version}"/>
        <attribute name="Specification-Vendor"     value="${author}"/>
        <attribute name="Implementation-Title"     value="${name}"/>
        <attribute name="Implementation-Version"   value="${version}"/>
        <attribute name="Implementation-Vendor"    value="${author}"/>
        <attribute name="Implementation-Vendor-Id" value="${author}"/>
      </manifest>
    </jar>
  </target>

</project>
